<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Translator</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .container {
            text-align: center;
            width: 100%;
            max-width: 600px;
            padding: 20px;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 20px;
            color: #333;
        }

        .drop-area {
            display: inline-block;
            width: 80%;
            max-width: 500px;
            padding: 20px;
            border-radius: 50px;
            background: #ffffff;
            border: 2px dashed #000000;
            color: #000000;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.3s ease;
            cursor: pointer;
            text-align: center;
            position: relative;
            outline: none;
        }

        .drop-area:focus {
            outline: 2px solid #000000;
        }

        .drop-area:hover {
            background: #000000;
            color: #fff;
            border-color: #fff;
        }

        .drop-area input {
            display: none;
        }

        .drop-area p {
            margin: 0;
            padding: 0;
            font-size: 1.2rem;
        }

        /* Animation for file drop */
        @keyframes growShrink {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
            }
        }

        .drop-area.file-added {
            animation: growShrink 0.6s ease forwards;
            border: 2px solid black;
            color: black;
        }
        .drop-area.processing {
            animation: growShrink 0.6s ease infinite; /* Infinite animation for processing */
        }
        /* Text and Three Dots Animation */
        @keyframes dotBlink {
            0%, 100% { content: "Processing"; }
            25% { content: "Processing."; }
            50% { content: "Processing.."; }
            75% { content: "Processing..."; }
        }

        .processing-indicator {
            font-size: 1.2rem;
            color: #333;
            display: none;
        }

        .dots:after {
            content: "Processing...";
            animation: dotBlink 1.5s infinite;
        }

        .success-message {
            display: none;
            font-size: 1.5rem;
            margin-top: 20px;
            color: green;
            font-weight: bold;
        }

        .error-message {
            display: none;
            font-size: 1.5rem;
            margin-top: 20px;
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Upload Your Audio File</h1>
    <div class="drop-area" id="dropArea" tabindex="0">
        <p>Drag and Drop a WAV File Here</p>
        <input type="file" id="fileInput" accept=".wav">
    </div>
    <!-- Processing indicator -->
    <div class="processing-indicator dots" id="processingIndicator"></div>
    <div class="success-message" id="successMessage">File uploaded and processed successfully!</div>
    <div class="error-message" id="errorMessage">Error occurred while processing the file.</div>
</div>

<script>
    const dropArea = document.getElementById("dropArea");
    const fileInput = document.getElementById("fileInput");
    const successMessage = document.getElementById("successMessage");
    const errorMessage = document.getElementById("errorMessage");
    const processingIndicator = document.getElementById("processingIndicator");

    // Open file dialog when the drop area is clicked
    dropArea.addEventListener("click", () => {
        fileInput.click();
    });

    // Handle file drop
    dropArea.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropArea.style.backgroundColor = "#e7f7e7";
    });

    dropArea.addEventListener("dragleave", () => {
        dropArea.style.backgroundColor = "white";
    });

    dropArea.addEventListener("drop", async (e) => {
        e.preventDefault();
        dropArea.style.backgroundColor = "white";
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            const file = files[0];
            await uploadFile(file);
        }
    });

    // Handle file input change
    fileInput.addEventListener("change", async () => {
        const file = fileInput.files[0];
        await uploadFile(file);
    });

    // // Upload file to the server
    // async function uploadFile(file) {
    //     successMessage.style.display = "none";
    //     errorMessage.style.display = "none";
    //     processingIndicator.style.display = "block";  // Show the processing indicator

    //     const formData = new FormData();
    //     formData.append("file", file);

    //     // Add animation to the drop-area
    //     dropArea.classList.add("file-added");

    //     try {
    //         const response = await fetch("/process-audio/", {
    //             method: "POST",
    //             body: formData,
    //         });

    //         if (response.ok) {
    //             successMessage.style.display = "block";
    //             const blob = await response.blob();
    //             const url = URL.createObjectURL(blob);
    //             const a = document.createElement("a");
    //             a.href = url;
    //             a.download = "translated_audio.wav";
    //             a.click();
    //         } else {
    //             throw new Error("Failed to process file");
    //         }
    //     } catch (error) {
    //         errorMessage.style.display = "block";
    //     } finally {
    //         processingIndicator.style.display = "none";  // Hide the processing indicator after done
    //     }
    // }
    // Upload file to the server
    async function uploadFile(file) {
        successMessage.style.display = "none";
        errorMessage.style.display = "none";

        const formData = new FormData();
        formData.append("file", file);

        // Change the drop-area text to "Processing..."
        const dropText = dropArea.querySelector("p");
        dropText.textContent = "Processing...";

        // Add animation to the drop-area
        dropArea.classList.add("file-added");

        try {
            const response = await fetch("/process-audio/", {
                method: "POST",
                body: formData,
            });

            if (response.ok) {
                successMessage.style.display = "block";
                const blob = await response.blob();
                const url = URL.createObjectURL(blob);
                const a = document.createElement("a");
                a.href = url;
                a.download = "translated_audio.wav";
                a.click();
            } else {
                throw new Error("Failed to process file");
            }
        } catch (error) {
            errorMessage.style.display = "block";
        } finally {
            // Revert the text back to original after processing
            dropText.textContent = "Drag and Drop a WAV File Here";
            dropArea.classList.remove("file-added");
        }
    }
    // Upload file to the server
    // async function uploadFile(file) {
    //     successMessage.style.display = "none";
    //     errorMessage.style.display = "none";

    //     const formData = new FormData();
    //     formData.append("file", file);

    //     // Change the drop-area text to "Processing..."
    //     const dropText = dropArea.querySelector("p");
    //     dropText.textContent = "Processing...";

    //     // Add the bounce animation for processing
    //     dropArea.classList.add("file-added", "processing");

    //     try {
    //         const response = await fetch("/process-audio/", {
    //             method: "POST",
    //             body: formData,
    //         });

    //         if (response.ok) {
    //             successMessage.style.display = "block";
    //             const blob = await response.blob();
    //             const url = URL.createObjectURL(blob);
    //             const a = document.createElement("a");
    //             a.href = url;
    //             a.download = "translated_audio.wav";
    //             a.click();
    //         } else {
    //             throw new Error("Failed to process file");
    //         }
    //     } catch (error) {
    //         errorMessage.style.display = "block";
    //     } finally {
    //         // Revert the text back to original and stop the animation after processing
    //         dropText.textContent = "Drag and Drop a WAV File Here";
    //         dropArea.classList.remove("file-added", "processing");
    //     }
    // }
</script>

</body>
</html>